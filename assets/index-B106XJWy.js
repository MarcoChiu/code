var p=[],y="all",E="";function H(){for(var a=[],r=0;r<p.length;r++){var e=p[r].categories;Array.isArray(e)&&e.forEach(function(c){a.includes(c)||a.push(c)})}return a.sort()}function O(){var a=H(),r=document.getElementById("menuItems");if(r.innerHTML="",a.forEach(function(c){var n=document.createElement("div");n.className="menu-item",n.setAttribute("data-section",c),n.textContent=c,n.onclick=function(){var i=document.querySelectorAll(".menu-item");i.forEach(function(s){s.classList.remove("active")}),this.classList.add("active"),y=this.getAttribute("data-section"),C(),window.innerWidth<=768&&b()},r.appendChild(n)}),a.length===0){var e=document.createElement("div");e.className="menu-item",e.setAttribute("data-section","page"),e.textContent="page",e.onclick=function(){var c=document.querySelectorAll(".menu-item");c.forEach(function(n){n.classList.remove("active")}),this.classList.add("active"),y="page",C(),window.innerWidth<=768&&b()},r.appendChild(e)}}function z(a,r){var e=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),c=[];function n(t,o){var l=c.length;return c.push({html:'<span class="token-'+o+'">'+t+"</span>"}),"###__PH__"+l+"__PH__###"}r==="javascript"?e=e.replace(/&quot;[^&]*?&quot;|&#x27;[^&]*?&#x27;|`[^`]*?`/g,function(t){return n(t,"string")}).replace(/\/\/[^\n]*/g,function(t){return n(t,"comment")}).replace(/\/\*[\s\S]*?\*\//g,function(t){return n(t,"comment")}):r==="csharp"?e=e.replace(/&quot;[^&]*?&quot;/g,function(t){return n(t,"string")}).replace(/\/\/[^\n]*/g,function(t){return n(t,"comment")}):r==="sql"?e=e.replace(/&quot;[^&]*?&quot;/g,function(t){return n(t,"string")}).replace(/--[^\n]*/g,function(t){return n(t,"comment")}):r==="scss"?e=e.replace(/&quot;[^&]*?&quot;|&#x27;[^&]*?&#x27;/g,function(t){return n(t,"string")}).replace(/\/\/[^\n]*/g,function(t){return n(t,"comment")}).replace(/\/\*[\s\S]*?\*\//g,function(t){return n(t,"comment")}):r==="css"?e=e.replace(/&quot;[^&]*?&quot;|&#x27;[^&]*?&#x27;/g,function(t){return n(t,"string")}).replace(/\/\*[\s\S]*?\*\//g,function(t){return n(t,"comment")}):r==="html"&&(e=e.replace(/&quot;[^&]*?&quot;|&#x27;[^&]*?&#x27;/g,function(t){return n(t,"string")}).replace(/&lt;!--[\s\S]*?--&gt;/g,function(t){return n(t,"comment")})),r==="javascript"?e=e.replace(/\b(const|let|var|function|return|if|else|for|while|do|switch|case|break|continue|import|from|export|default|async|await|try|catch|finally|throw|new|this|super|extends|class|true|false|null|undefined)\b/g,'<span class="token-keyword">$1</span>').replace(/\b([a-zA-Z_]\w*)\s*(?=\()/g,'<span class="token-function">$1</span>').replace(/\b(\d+)\b/g,'<span class="token-number">$1</span>').replace(/&lt;([a-zA-Z][a-zA-Z0-9-]*)/g,'&lt;<span class="token-keyword">$1</span>').replace(/&lt;\/([a-zA-Z][a-zA-Z0-9-]*)/g,'&lt;/<span class="token-keyword">$1</span>'):r==="csharp"?e=e.replace(/\b(public|private|protected|static|class|void|var|using|async|await|Task|new|return|if|else|for|while|from|where|select|throw|try|catch|finally)\b/g,'<span class="token-keyword">$1</span>').replace(/\b(List|Dictionary|HttpClient|string|int|bool|double|float|decimal|long|short)\b/g,'<span class="token-type">$1</span>').replace(/\b(\d+)\b/g,'<span class="token-number">$1</span>'):r==="sql"?e=e.replace(/\b(SELECT|FROM|WHERE|CREATE|PROCEDURE|AS|BEGIN|END|EXEC|INSERT|UPDATE|DELETE|JOIN|ON|LEFT|RIGHT|INNER|OUTER|GROUP|BY|ORDER|DESC|ASC|INT|VARCHAR|NVARCHAR|DATETIME)\b/gi,'<span class="token-keyword">$&</span>').replace(/\b(\d+)\b/g,'<span class="token-number">$1</span>'):r==="scss"?e=e.replace(/(@[\w-]+)/g,'<span class="token-keyword">$1</span>').replace(/([\w-]+)(?=\s*:)/g,'<span class="token-property">$1</span>').replace(/(#[0-9a-f]{3,6}|[\d.]+(?:px|em|%|rem|ch|ex|cm|mm|in|pt|pc|vh|vw))/gi,'<span class="token-number">$1</span>'):r==="css"?e=e.replace(/([\w-]+)(?=\s*\{)/g,'<span class="token-selector">$1</span>').replace(/([\w-]+)(?=\s*:)/g,'<span class="token-property">$1</span>').replace(/(#[0-9a-f]{3,6}|[\d.]+(?:px|em|%|rem|ch|ex|cm|mm|in|pt|pc|vh|vw))/gi,'<span class="token-number">$1</span>'):r==="html"&&(e=e.replace(/&lt;([a-zA-Z][a-zA-Z0-9-]*)/g,'&lt;<span class="token-keyword">$1</span>').replace(/&lt;\/([a-zA-Z][a-zA-Z0-9-]*)/g,'&lt;/<span class="token-keyword">$1</span>'));for(var i=Math.max(5,c.length),s=0;/###__PH__(\d+)__PH__###/.test(e)&&s<i;)e=e.replace(/###__PH__(\d+)__PH__###/g,function(t,o){var l=Number(o);return c[l]&&c[l].html?c[l].html:""}),s++;return e}function I(a){var r=a.toLowerCase().replace(/\s/g,"").replace("#","sharp").replace("ms",""),e=document.createElement("span");return e.className="category-badge "+r,e.textContent=a,e}function C(){for(var a=[],r=0;r<p.length;r++){var e=p[r],c=y==="all"||Array.isArray(e.categories)&&e.categories.indexOf(y)!==-1,n=!E||e.title.toLowerCase().indexOf(E)!==-1||e.description.toLowerCase().indexOf(E)!==-1;if(!n&&Array.isArray(e.code)){for(var i=0;i<e.code.length;i++)if(e.code[i].content.toLowerCase().indexOf(E)!==-1){n=!0;break}}c&&n&&a.push(e)}document.getElementById("count").textContent=a.length;var s=document.getElementById("codeGrid");s.innerHTML="";for(var r=0;r<a.length;r++){var t=a[r],o=document.createElement("div");o.className="code-card";var l=document.createElement("div");l.className="card-header";var u=document.createElement("div");u.className="card-title";var g=document.createElement("h3");g.textContent=t.title;var m=document.createElement("div");m.className="category-badges";var d=(t.title||"").split(/[-_\s]+/),A=d[0]&&d[0].length?d[0]:t.categories&&t.categories[0]||"page";m.appendChild(I(A)),u.appendChild(g),u.appendChild(m),l.appendChild(u);var v=document.createElement("div");v.className="code-block";var f=document.createElement("button");if(f.className="copy-btn",f.textContent="複製全部",f.setAttribute("data-id",t.id),f.onclick=function(){for(var L=parseInt(this.getAttribute("data-id")),w=0;w<p.length;w++)if(p[w].id===L){var R=p[w].code.map(function(S){return"// "+S.language+`
`+S.content}).join(`

`);navigator.clipboard.writeText(R),this.textContent="已複製!",this.classList.add("copied");var T=this;setTimeout(function(){T.textContent="複製全部",T.classList.remove("copied")},2e3);break}},v.appendChild(f),Array.isArray(t.code))for(var h=0;h<t.code.length;h++){var x=t.code[h],_=document.createElement("div");_.style.cssText="padding: 10px 20px; background: rgba(0, 0, 0, 0.3); border-bottom: 1px solid rgba(255, 255, 255, 0.1); color: #61AFEF; font-size: 12px; font-weight: 600;",_.textContent=x.language.toUpperCase(),v.appendChild(_);var q=document.createElement("pre"),N=document.createElement("code"),$=z(x.content,x.language);N.innerHTML=$,q.appendChild(N),v.appendChild(q)}var k=document.createElement("div");k.className="card-footer",k.textContent=Array.isArray(t.code)?t.code.map(function(L){return L.language}).join(" + "):"",o.appendChild(l),o.appendChild(v),o.appendChild(k),s.appendChild(o)}}function b(){document.getElementById("sidebar").classList.toggle("show")}window.toggleSidebar=b;document.getElementById("searchInput").addEventListener("input",function(a){E=a.target.value.toLowerCase(),C()});document.querySelectorAll(".menu-item")[0].addEventListener("click",function(){for(var a=document.querySelectorAll(".menu-item"),r=0;r<a.length;r++)a[r].classList.remove("active");this.classList.add("active"),y="all",C(),window.innerWidth<=768&&b()});function P(a,r){for(var e=new DOMParser,c=e.parseFromString(a,"text/html"),n=c.querySelector("title")?c.querySelector("title").textContent:r,i=c.body||document.createElement("body"),s=i.cloneNode(!0),t=s.querySelectorAll("script"),o=0;o<t.length;o++)t[o].parentNode.removeChild(t[o]);var l=s.innerHTML.trimEnd(),u=i.querySelectorAll("script"),g=[];l&&g.push({language:"html",content:l});for(var m=0;m<u.length;m++){var d=u[m].textContent||"";d=d.trimEnd(),d&&g.push({language:"javascript",content:d})}var A=n.split(/[\s\-_]+/),v=A[0]||"Uncategorized",f=[v],h=r.replace(/\.html$/i,"").replace(/[^a-zA-Z0-9_\-]/g,"_");return{id:h,title:n,categories:f,description:"從 page 資料夾的 "+r+" 解析而來",source:{text:"page",url:"../page/"+r},code:g}}const Z=async()=>{try{Loading.show();var a={react:["react001.html","react002.html","react003.html","react004.html"],javascript:[],csharp:[]},r=[];Object.keys(a).forEach(function(n){var i=a[n];i.forEach(function(s){var t=window.__BASE_URL__+"page/"+n+"/"+s;r.push(fetch(t).then(function(o){if(!o.ok)throw new Error("fetch "+n+"/"+s+" failed: "+o.status);return o.text()}).then(function(o){return P(o,s)}).catch(function(o){return console.error("無法載入頁面檔案:",n+"/"+s,o),null}))})});var e=await Promise.all(r),c=e.filter(function(n){return n});p=c,O(),C()}catch(n){console.error("初始化失敗",n)}finally{Loading.hide()}};Z();
